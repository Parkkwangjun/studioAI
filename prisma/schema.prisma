generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id           String   @id @default(uuid())
  title        String
  description  String?
  platform     String
  category     String
  tone         String
  targetLength String
  language     String
  status       String   @default("draft") // draft, in-progress, completed
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  scenes       Scene[]
  imageAssets  ImageAsset[]
  videoClips   VideoClip[]
}

model Scene {
  id        String   @id @default(uuid())
  projectId String
  index     Int
  text      String
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  audioClips AudioClip[]
  imageAssets ImageAsset[]
}

model AudioClip {
  id          String   @id @default(uuid())
  sceneId     String
  url         String
  provider    String
  voiceId     String
  speed       Float
  durationSec Float?
  status      String   @default("pending") // pending, ready, failed
  error       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  scene       Scene    @relation(fields: [sceneId], references: [id], onDelete: Cascade)
}

model ImageAsset {
  id        String   @id @default(uuid())
  projectId String
  sceneId   String?
  url       String
  prompt    String
  model     String
  isMain    Boolean  @default(false)
  status    String   @default("pending") // pending, ready, failed
  error     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  scene     Scene?   @relation(fields: [sceneId], references: [id])
}

model VideoClip {
  id          String   @id @default(uuid())
  projectId   String
  url         String?
  aspectRatio String
  durationSec Float?
  status      String   @default("pending") // pending, rendering, ready, failed
  error       String?
  externalTaskId String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Settings {
  id                String   @id @default(uuid())
  defaultLanguage   String   @default("ko")
  defaultTone       String   @default("polite")
  defaultImageStyle String   @default("cinematic")
  defaultTtsVoice   String   @default("en-US-Chirp3-HD-Fenrir")
  scriptModel       String   @default("gemini-1.5-pro")
  imageModel        String   @default("fal-ai/flux/dev")
  ttsProvider       String   @default("google")
  videoProvider     String   @default("kie")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
